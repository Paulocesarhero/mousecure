<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../CSS/NavBarStyle.css">

    <title>Polizas</title>
    <style>
        main {
            margin-top: 60px;
            /* Ajusta este valor según la altura de tu navbar */
        }

        .container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            padding: 20px;
        }

        .box-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }

        .box {
            flex: 0 1 auto;
            min-width: 300px;
            /* Esto hará que los select tengan al menos 300px de ancho */
            height: 40px;
            /* Puedes ajustar esto a lo que necesites */
            padding: 5px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            /* Ajusta esto a lo que necesites */
        }

        .btn {
            background-color: #007BFF;
            /* Color de fondo azul */
            color: white;
            /* Color de texto blanco */
            border: none;
            /* Sin borde */
            padding: 15px 32px;
            /* Espaciado interno */
            text-align: center;
            /* Alineación del texto */
            text-decoration: none;
            /* Sin decoración de texto */
            display: inline-block;
            /* Display inline-block */
            font-size: 16px;
            /* Tamaño de fuente */
            margin: 4px 2px;
            /* Margen */
            cursor: pointer;
            /* Cursor de mano */
            transition: transform 0.3s;
            /* Transición suave al mover */
        }

        /* Estilo del botón al pasar el mouse */
        .btn:hover {
            background-color: #0056b3;
            /* Color de fondo azul oscuro */
            transform: scale(1.1);
            /* Aumenta el tamaño del botón */
        }
    </style>
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="logo">
                <img src="../Resources/Icons/Mousecure - LT.png" height="32px" weight="32px" />MouSecure
            </div>

            <ul class="nav-links">
                <li class="dropdown">
                    <a tabindex="0">
                        <div class="imagen-contenedor">
                            <img id="imagenDinamica" src="../Resources/Icons/FlechaAbj - LT.png" alt="Imagen"
                                height="16px" weight="16px">
                        </div>
                        Reportes
                    </a>
                    <ul class="dropdown-content">
                        <li><a href="#"><img src="../Resources/Icons/ReportesUsuario - LT.png" height="32px"
                                    weight="32px" />Mis reportes</a></li>
                        <li><a href="../html/ReportarSiniestro.html"><img
                                    src="../Resources/Icons/ReportarSiniestro - LT.png" height="32px"
                                    weight="32px" />Reportar Siniestros</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a tabindex="0">
                        <div class="imagen-contenedor">
                            <img id="imagenDinamica" src="../Resources/Icons/FlechaAbj - LT.png" alt="Imagen"
                                height="16px" weight="16px">
                        </div>
                        Pólizas
                    </a>
                    <ul class="dropdown-content">
                        <li><a href="#"><img src="../Resources/Icons/PolizasUsuario - LT.png" height="32px"
                                    weight="32px" />Mis Pólizas</a></li>
                        <li><a href="#"><img src="../Resources/Icons/PolizasComprar - LT.png" height="32px"
                                    weight="32px" />Comprar Pólizas</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a tabindex="0">
                        <div class="imagen-contenedor">
                            <img id="imagenDinamica" src="../Resources/Icons/FlechaAbj - LT.png" alt="Imagen"
                                height="16px" weight="16px">
                        </div>
                        Contactos
                    </a>
                    <ul class="dropdown-content">
                        <li><a href="#"><img src="../Resources/Icons/ContactoCorreo - LT.png" height="32px"
                                    weight="32px" />Correo Electrónico</a></li>
                        <li><a href="#"><img src="../Resources/Icons/ContactoTelefono - LT.png" height="32px"
                                    weight="32px" />Número de celular</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a tabindex="0">
                        <img id="usuario_Option" src="../Resources/Icons/User - LT.png" height="35px" weight="35px" />
                    </a>
                    <ul class="dropdown-content">
                        <li><a href="#"><img src="../Resources/Icons/Ajustes - LT.png" height="32px"
                                    weight="32px" />Ajustes</a></li>
                        <li><a tabindex="0" id="logOut_NavBar"><img src="../Resources/Icons/LogOut - LT.png"
                                    height="32px" weight="32px" />Cerrar Sesión</a></li>
                    </ul>
                </li>
            </ul>

            <div class="menu-hamburguesa" tabindex="0">
                <img src="../Resources/Icons/HMenu - LT.png" height="35px" weight="35px" />
            </div>

            <div id="sidebar" class="sidebar">
                <ul class="sidebar-nav-links">
                    <li><a href="#" class="sidebar-header-User-Icon" tabindex="-1"><img id="usuario_Option_SideBar"
                                src="../Resources/Icons/User - LT.png" height="35px" weight="35px" />[Nombre de
                            Usuario]</a></li>
                    &nbsp;
                    <li class="sidebar-header">Reportes</li>
                    <hr>
                    <li class="sidebar-options"><a href="#" tabindex="-1"><img
                                src="../Resources/Icons/ReportesUsuario - LT.png" height="32px" weight="32px" />Mis
                            reportes</a></li>
                    <hr>
                    <li class="sidebar-options"><a href="#" tabindex="-1"><img
                                src="../Resources/Icons/ReportarSiniestro - LT.png" height="32px"
                                weight="32px" />Reportar Siniestros</a></li>
                    <hr>
                    &nbsp;
                    <li class="sidebar-header">Polizas</li>
                    <hr>
                    <li class="sidebar-options"><a href="#" tabindex="-1"><img
                                src="../Resources/Icons/PolizasUsuario - LT.png" height="32px" weight="32px" />Mis
                            Pólizas</a></li>
                    <hr>
                    <li class="sidebar-options"><a href="#" tabindex="-1"><img
                                src="../Resources/Icons/PolizasComprar - LT.png" height="32px" weight="32px" />Comprar
                            Pólizas</a></li>
                    <hr>
                    &nbsp;
                    <li class="sidebar-header">Contactos</li>
                    <hr>
                    <li class="sidebar-options"><a href="#" tabindex="-1"><img
                                src="../Resources/Icons/ContactoCorreo - LT.png" height="32px" weight="32px" />Correo
                            Electrónico</a></li>
                    <hr>
                    <li class="sidebar-options"><a href="#" tabindex="-1"><img
                                src="../Resources/Icons/ContactoTelefono - LT.png" height="32px" weight="32px" />Número
                            de celular</a></li>
                    <hr>
                    &nbsp;
                    <hr>
                    <li class="sidebar-options"><a id="logOut_SideBar" tabindex="-1"><img
                                src="../Resources/Icons/LogOut - LT.png" height="32px" weight="32px" />Cerrar Sesión</a>
                    </li>
                    <hr>
                </ul>
            </div>
        </nav>
    </header>
    <main>
        <form>
            <div class="container">
                <div class="box-container">
                    <p>Seleccione su Vehículo</p>
                    <select class="box" required>
                        <option value="">Selecciona una opción</option>
                        <!-- Agrega más opciones aquí -->
                    </select>
                </div>
                <div class="box-container">
                    <p>Escoga su póliza</p>
                    <select id="vehicle-select" class="box" required>
                        <option value="">Seleccione una opción</option>
                        <option value="1">Bronce</option>
                        <option value="2">Plata</option>
                        <option value="3">Oro</option>
                    </select>
                </div>
            </div>
            <div class="button-container">
                <button class="btn" type="submit">Actualizar</button>
            </div>
        </form>
    </main>


</body>

<script>
    var vehiculos = []; // Esta variable almacenará todos los vehículos
    var vehiculoIdSeleccionado = null; // Esta variable almacenará el id del vehículo seleccionado

    window.onload = function () {
        var idConductor = '1'; // Reemplaza esto con el ID del conductor real
        fetch(`http://localhost:8000/vehiculos/${idConductor}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // Aquí puedes manejar los vehículos que recibiste de la API
                if (data.length === 0) {
                    alert('No se han encontrado vehículos');
                } else {
                    vehiculos = data;
                    var select = document.querySelector('.box');
                    vehiculos.forEach((vehiculo, index) => {
                        var option = document.createElement('option');
                        option.text = vehiculo.modelo;
                        option.value = vehiculo.id; // Guardamos el idVehiculo en el valor de la opción
                        select.add(option);
                    });
                }
            })
            .catch(error => {
                console.log('Hubo un problema con la petición Fetch: ' + error.message);
            });

        // Agregamos un evento 'change' al combo box para actualizar el vehículo seleccionado
        document.querySelector('.box').addEventListener('change', function () {
            vehiculoIdSeleccionado = this.value;
            alert('El ID del vehículo seleccionado es: ' + vehiculoIdSeleccionado);

        });
    }

    document.querySelector('.btn').addEventListener('click', function (event) {
        var form = document.querySelector('form');
        if (!form.checkValidity()) {
            // Si el formulario no es válido, se mostrarán los mensajes de validación predeterminados
            return;
        }
        event.preventDefault();
        
        var selectedValue = document.querySelector('#vehicle-select').value;        
        //alert(selectedValue); // Alerta de error 
    
        var updatedData = {
            idPlan: selectedValue,
            idVehiculo: vehiculoIdSeleccionado.toString()
        };
        


        fetch(`http://localhost:8000/poliza/update${vehiculoIdSeleccionado}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedData),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('Exito al actualizar la poliza'); // Alerta de error
                form.reset();

            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Error al actualizar la poliza'); // Alerta de error

            });
    });
</script>

</html>